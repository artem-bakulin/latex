\documentclass{beamer}

\usepackage{cmap}				% To be able to copy-paste russian text from pdf
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{textpos}
\usepackage{ragged2e}
\usepackage{amssymb}
\usepackage{ulem}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{color}
\usepackage{cancel}
\usepackage{multirow}
\pgfplotsset{compat=1.17}
\usetikzlibrary{arrows,snakes,backgrounds,shapes}
\usepgfplotslibrary{groupplots,colorbrewer,dateplot,statistics}
\usepackage{animate}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage{cancel}

\usepackage{enumitem}
\setitemize{label=\usebeamerfont*{itemize item}%
  \usebeamercolor[fg]{itemize item}
  \usebeamertemplate{itemize item}}

% remove navigation bar
\setbeamertemplate{navigation symbols}{} 

\usepackage{eurosym}
\renewcommand{\EUR}[1]{\textup{\euro}#1}

\title{Опционы. Биномиальная модель}
\author{Артём Бакулин}
\date{18 марта 2024 г.}

\usetheme{Warsaw}
\usecolortheme{beaver}

\setbeamertemplate{page number in head/foot}[totalframenumber] 

\newcommand{\ru}[1]{\begin{otherlanguage}{russian}#1\end{otherlanguage}}
\newcommand{\en}[1]{\begin{otherlanguage}{english}#1\end{otherlanguage}}
\newcommand{\ruen}[2]{#1 (\en{#2})}

\newcommand{\usdrubstrike}{96}
\newcommand{\usdrubaxisspread}{8}
\newcommand{\usdrublow}{70}
\newcommand{\usdrubhigh}{120}
\newcommand{\highminusstrikepremium}{22}
\newcommand{\strikeminuslowpremium}{24}
\newcommand{\usdrubbarrier}{100}

\begin{document}



\begin{frame}
\titlepage
\end{frame}



\begin{frame}{Опционы}
\justifying
\alert{Опцион колл [пут]} --- контракт, который даёт владельцу право, но не обязанность, купить [продать] базовый актив по заранее оговорённой цене в заранее определённую дату. 

\justify
Пример: колл-опцион, который даёт право (но не обязанность) купить 1\,000 долларов за \usdrubstrike\,000 рублей через 3 месяца. Сегодня за такой опцион нужно заплатить 2\,000 рублей.
\end{frame}



\begin{frame}{Опционы - 2}
\begin{itemize}
\justifying
\item \alert{Колл} (call) --- право купить актив, \alert{пут} (put) --- право продать.
\item \alert{Страйк} (strike) --- фиксированная цена, по которой можно будет купить или продать базовый актив.
\item \alert{Премия} (premium) --- сумма, которую нужно заплатить сегодня, чтобы получить опцион.
\item \alert{Выписать} опцион (write an option) --- то же самое, что продать опцион.
\item \alert{Дата экспирации} (expiration date) --- дата, в которую опцион прекращает действовать, если владелец его не использовал.
\item \alert{Европейский} опцион (\en{European option}) --- воспользоваться правом можно только в дату экспирации.
\item \alert{Американский} опцион (\en{American option}) --- воспользоваться правом можно в любой день до экспирации.
\end{itemize}
\end{frame}



\newcommand{\circlewithtext}[3]{
    \node[circle, fill, inner sep = 1.5pt] at (#1, #2) {};
    \node[anchor = north] at (#1, #2) {#3};
}

\begin{frame}{Опцион на валюту}
\justify
\centering
\begin{tikzpicture}
		\draw [->,>=triangle 90] (0, 0) -- (9.5, 0);
		
		\draw [->, >=triangle 45] (0.5, 0) .. controls (1.0, 1) and (2.0, 1) .. (2.5, 0) node[pos=0.5, anchor=south]{+1 день};
		
		\draw [->, >=triangle 45] (2.5, 0) .. controls (3, 2) and (8, 2) .. (8.5, 0) node[pos=0.5, anchor=north]{+3 месяца};
		
		\draw [->, >=triangle 45] (8.5, 0) .. controls (8, 0.5) and (7, 0.5) .. (6.5, 0) node[pos=0.5, anchor=south]{$-1$ день};
		
		\circlewithtext{0.5}{0}{Сегодня};
		\circlewithtext{2.5}{0}{\begin{tabular}{c}Спот \\ $-2\,000$ RUB \end{tabular}};
		\circlewithtext{6.5}{0}{Экспирация};
		\circlewithtext{8.5}{0}{\begin{tabular}{c}Поставка \\ $+1\,000$ USD\\ $-\usdrubstrike\,000$ RUB\end{tabular}};
	\end{tikzpicture}
	
\justify
1. Сегодня продавец и покупатель подписывают контракт.

\justify
2. В спот-дату (\en{spot date}) покупатель платит премию.

\justify
3. В дату экспирации (\en{expiration date}) покупатель опциона сообщает продавцу о желании исполнить опцион.

\justify
4. В дату поставки (\en{settlement date}) стороны произведут обмен валюты, если опцион был исполнен.

\justify
Дальше в курсе мы будем считать, что премия платится в день сделки, а даты экспирации и поставки совпадают.
\end{frame}



\begin{frame}{Ванильные опционы}
\justify
Европейские опционы колл и пут называют \alert{ванильными} (\en{plain vanilla}), потому что самое простое мороженое без ничего --- ванильное.

\justify
<<Первый канал>> об убытках банка \en{Societe General}, 25.01.2008:

\justify
<<Источник агентства Reuters в самом банке на условиях анонимности сообщил, что в последнее время трейдер, о котором идет речь, покупал и продавал контракты на поставку обычной ванили. \alert{Той самой, которую используют в кулинарии}. Правда, ванили на 7 миллиардов долларов, в год не производят и во всем мире. Фактически речь идет о торговле воздухом. Хотя это вполне законно и используется повсеместно.>>

\justify
\url{https://www.newsru.com/russia/25Jan2008/vanilla.html}
\end{frame}



\begin{frame}{Пример: колл-опцион}
\justifying
Колл-опцион на покупку долларов за рубли со страйком \usdrubstrike.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-3, ymax=8,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
		]
  \addplot[Set1-A, very thick] {(\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.05};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Пример: покупаем колл-опцион}
\justifying
Покупка колл-опциона со страйком \usdrubstrike\ за премию 2 руб.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-3, ymax=8,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)},
		]
  \addplot[Set1-A, very thick] {(\x > \usdrubstrike)*(\x - \usdrubstrike) - 2};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Пример: покупаем пут-опцион}
\justifying
Покупка пут-опциона со страйком \usdrubstrike\ за премию 2 руб.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-3, ymax=8,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)},
		]
  \addplot[Set1-A, very thick] {(\x < \usdrubstrike)*(\usdrubstrike - \x) - 2};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Пример: продаём колл-опцион}
\justifying
Продажа колл-опциона со страйком \usdrubstrike\ за премию 2 руб.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-8, ymax=3,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)},
		]
  \addplot[Set1-A, very thick] {(\x > \usdrubstrike)*(\usdrubstrike - \x) + 2};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Пример: продаём пут-опцион}
\justifying
Продажа пут-опциона со страйком \usdrubstrike\ за премию 2 руб.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-8, ymax=3,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)},
		]
  \addplot[Set1-A, very thick] {(\x < \usdrubstrike)*(\x - \usdrubstrike) + 2};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{хеджирование с помощью опционов}
\justify
Через три месяца нам понадобится \$1\,000 на отпуск. Форвардный курс на три месяца \usdrubstrike. Если купить форвард, мы зафиксируем курс, но что делать, если рубль укрепится до \usdrublow? Будет обидно покупать доллары по \usdrubstrike\ при рыночном курсе \usdrublow.

\justify
Решение: можно купить колл-опцион со страйком \usdrubstrike\ на \$1\,000 за премию 2\,000 рублей. Если доллар сильно вырастет, мы исполняем опцион и покупаем по \usdrubstrike. Если рубль внезапно укрепляется до \usdrublow, то опцион пропадает, а мы покупаем по рыночному курсу \usdrublow.

\justify
Плюс: не так обидно при укреплении рубля. Минус: прямо сейчас нужно заплатить за опцион. Опцион работает как страховка от падения рубля.
\end{frame}




\begin{frame}{хеджирование с помощью опционов - 2}
\justify
Через три месяца нам придут дивиденды \$1\,000 от иностранных инвестиций. Тогда же нам нужно будет заплатить рубли за ипотеку. Форвардный курс на три месяца \usdrubstrike. Если продать форвард, мы зафиксируем курс, но что делать, если рубль ослабнет до \usdrubhigh? Будет обидно продавать доллары по \usdrubstrike\ при рыночном курсе \usdrubhigh.

\justify
Решение: можно купить пут-опцион со страйком \usdrubstrike\ на \$1\,000 за премию 2\,000 рублей. Если доллар упадёт до \usdrublow, мы исполняем опцион и продаём доллары по \usdrubstrike. Если доллар укрепится до \usdrubhigh, опцион пропадает, а мы продадим доллары по рыночному курсу \usdrubhigh.

\justify
Плюс: не так обидно при укреплении доллара. Минус: прямо сейчас нужно заплатить за опцион. Опцион работает как страховка от укрепления рубля.
\end{frame}



\begin{frame}{Спекуляция с помощью опционов}
\justify
Хрустальный шар показал, что за три месяца доллар сильно укрепится относительного текущего форвардного курса \usdrubstrike. Мы хотим на этом заработать, но \sout{жена} акционеры нашего хедж-фонда выделили нам бюджет всего 2\,000 рублей.

\justify
Решение: можно купить колл-опцион со страйком \usdrubstrike\ на \$1\,000 за премию 2\,000 рублей. Если доллар укрепится до \usdrubhigh\ рублей, мы заработаем $(\usdrubhigh - \usdrubstrike) \cdot 1\,000 - 2\,000 = \highminusstrikepremium\,000$ рублей. Если этого не случится, мы просто потеряем нашу ставку.

\justify
Опцион позволяет взять <<плечо>> --- увеличить выигрыш при хорошем исходе (как будто у нас есть целая \$1\,000) ценой потерь в худшем исходе (можно потерять всю премию). Однако, проигрыш строго ограничен снизу, а выигрыш может быть бесконечно большим.
\end{frame}



\begin{frame}{Спекуляция с помощью опционов - 2}
\justify
Хрустальный шар показал, что за три месяца доллар сильно упадёт относительного текущего форвардного курса \usdrubstrike. Мы хотим на этом заработать, но \sout{жена} акционеры нашего хедж-фонда выделили нам всего 2\,000 рублей.

\justify
Решение: можно купить пут-опцион со страйком \usdrubstrike\ на \$1\,000 за премию 2\,000 рублей. Если доллар упадёт до \usdrublow\ рублей, мы заработаем $(\usdrubstrike - \usdrublow) \cdot 1\,000 - 2\,000 = \strikeminuslowpremium\,000$ рублей. Если этого не случится, мы просто потеряем нашу ставку.

\justify
Опцион пут позволяет сделать ставку на падение базового актива (доллара).
\end{frame}



\begin{frame}{Денежность опционов}
\justify
Несколько стандартных терминов для <<денежности>> (\en{moneyness}) колл-опционов:

\justify
1. В деньгах (\en{in the money, ITM}) --- текущая цена базового актива выше страйка (опцион было бы выгодно исполнить прямо сейчас).

\justify
2. На деньгах (\en{at the money, ATM}) --- текущая цена базового актива равна страйку.

\justify
3. Вне денег (\en{out of the money, OTM}) --- текущая цена базового актива ниже страйка (было бы не выгодно исполнять опцион прямо сейчас).

\justify
Для пут-опционов терминология симметричная.
\end{frame}



\begin{frame}{Комбинации: коллар}
\justifying
Коллар (\en{collar}) --- проданный пут с меньшим страйком и купленный колл с большим страйком.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-6, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)},
			%scaled x ticks=false
		]
	
  \addplot[Set1-A, very thick, dashed] {-(\x < \usdrubstrike-2)*(\usdrubstrike-2 - \x) + 0.5};
  \addplot[Set1-B, very thick, dashed] {(\x > \usdrubstrike+2)*(\x - \usdrubstrike-2) - 0.5};
  \addplot[Set1-C, very thick] {-(\x < \usdrubstrike-2)*(\usdrubstrike-2 - \x) + 0.5 + (\x > \usdrubstrike+2)*(\x - \usdrubstrike-2) - 0.5 + 0.05};	

  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Комбинации: колл-спред}
\justifying
Колл-спред (\en{call spread}) --- купленный колл с меньшим страйком, проданный колл с большим страйком.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-6, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)}
		]
		
	  \addplot[Set1-A, very thick, dashed] {(\x > \usdrubstrike-2)*(\x - \usdrubstrike+2) - 1};
  \addplot[Set1-B, very thick, dashed] {-(\x > \usdrubstrike+2)*(\x - \usdrubstrike-2) + 0.5};
  \addplot[Set1-C, very thick] {(\x > \usdrubstrike-2)*(\x - \usdrubstrike+2) - 1 -(\x > \usdrubstrike+2)*(\x - \usdrubstrike-2) + 0.5};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Комбинации: стрэддл}
\justifying
Стрэддл (\en{straddle}) --- купленные колл и пут с одинаковыми страйками.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-6, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Прибыль (profit'n'loss)}
		]
		
	  \addplot[Set1-A, very thick, dashed] {(\x < \usdrubstrike)*(\usdrubstrike - \x) - 1};
  \addplot[Set1-B, very thick, dashed] {(\x > \usdrubstrike)*(\x - \usdrubstrike) - 1};
  \addplot[Set1-C, very thick] {(\x < \usdrubstrike)*(\usdrubstrike - \x) - 1 + (\x > \usdrubstrike)*(\x - \usdrubstrike) - 1};
  
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Комбинации: колл-опцион и пут-опцион}
\justifying
Купленные колл и проданный пут с одинаковым страйком (без учёта премии).

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-6, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
			%scaled x ticks=false
		]
		
	\addplot[Set1-A, very thick, dashed] {(\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.1};
  	\addplot[Set1-B, very thick, dashed] {-(\x < \usdrubstrike)*(\usdrubstrike-\x) - 0.1};
  	\addplot[Set1-C, very thick] {(\x > \usdrubstrike)*(\x - \usdrubstrike) -(\x < \usdrubstrike)*(\usdrubstrike-\x) };
 
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Комбинации: базовый актив и долг}
\justifying
1 доллар и долг в \usdrubstrike\ рублей.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-6, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)}
		]
		
  	\addplot[Set1-C, very thick] {\x - \usdrubstrike};
 
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Паритет опционов колл и пут}
\justify
Следующие два портфеля дают одинаковую выплату в день экспирации $T$:

1. Купленный колл и проданный пут, оба со страйком $K$.

2. Базовый актив ценой $S(T)$ и долг в $K$ денег.

\justify
Следовательно, в любой день $t$ до даты экспирации ($t<T$) они тоже должны стоить одинаковых денег с учётом ставки дисконтирования $r$ (*):
\begin{align*}
C_K(t) - P_K(t) = S(t) - Ke^{-r(T-t)}
\end{align*}

\justify
Это свойство называется \alert{паритет опционов колл и пут} (\en{call-put parity}). Оно позволяет выразить цену колла через пут или наоборот.

\justify
(*) Если базовый актив имеет дивидендную доходность $q$ (например, $q$ --- процентная ставка в долларах):
\begin{align*}
C_K(t) - P_K(t) = S(t)e^{-q(T-t)} - Ke^{-r(T-t)}
\end{align*}
\end{frame}



\begin{frame}{Цифровые опционы}
\justify
Европейский \alert{цифровой} (\en{digital}) опцион колл [пут] --- контракт, по которому 
владелец получит фиксированную выплату, если цена базового актива на момент экспирации 
будет выше [ниже] заранее зафиксированного страйка.

\justify
Пример: европейский цифровой колл на пару доллар-рубль со страйком \usdrubstrike, экспирацией 
через 3 месяца и номиналом 1\,000 рублей.

\justify
Владелец получит 1\,000 рублей, если через 3 
месяца спот-курс будет выше \usdrubstrike. Сейчас за такой опцион нужно заплатить премию 500 
рублей.
\end{frame}



\begin{frame}{Покупаем цифровой колл}
\justifying
Цифровой колл: страйк \usdrubstrike, номинал 1 р.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-2, ymax=2,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
			%scaled x ticks=false
		]
		
	\addplot[Set1-A, very thick, domain=\usdrubstrike:(\usdrubstrike + \usdrubaxisspread)] {1};
	\addplot[Set1-A, very thick, domain=(\usdrubstrike - \usdrubaxisspread):\usdrubstrike] {0.02};
 
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Покупаем цифровой пут}
\justifying
Цифровой пут: страйк \usdrubstrike, номинал 1 р.

\justifying
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike - \usdrubaxisspread):(\usdrubstrike + \usdrubaxisspread),
			xmin=(\usdrubstrike - \usdrubaxisspread), xmax=(\usdrubstrike + \usdrubaxisspread),
			ymin=-2, ymax=2,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)}
		]
		
	\addplot[Set1-A, very thick, domain=\usdrubstrike:(\usdrubstrike + \usdrubaxisspread)] {0.02};
	\addplot[Set1-A, very thick, domain=(\usdrubstrike - \usdrubaxisspread):\usdrubstrike] {1};
 
  \draw[thick, color=black] (axis cs: \usdrubstrike - \usdrubaxisspread, 0) -- (axis cs: \usdrubstrike + \usdrubaxisspread, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Спекуляция с помощью цифровые опционов}
\justify
Цифровой опцион --- удобный инструмент для спекуляции. Вы увидели в стеклянном шаре,
что курс будет выше (ниже) определённого уровня, но не знаете, будет ли он сильно выше
или совсем чуть-чуть. Вы покупаете цифровой колл (пут) и делаете ставку.

\justify
Плюсы: простая функция выплаты, цена --- почти что вероятность (сколько рублей вы 
заплатите за ставку, которая заработает 1000 рублей, если доллар будет выше \usdrubstrike?). 

\justify
Недостатки: сложно хеджировать опцион, если к моменту экспирации цена базового актива окажется около страйка. Маркет-мейкеры закладывают это неудобство в спред bid-ask.

\justify
Можно ли как-то связать цену цифрового опциона с ценой европейского опциона?
\end{frame}

\newcommand{\leftstrikeA}{95.5}
\newcommand{\leftstrikeB}{95.75}
\newcommand{\leftstrikeC}{95.95}
\newcommand{\rightstrikeA}{96.5}
\newcommand{\rightstrikeB}{96.25}
\newcommand{\rightstrikeC}{96.05}

\begin{frame}{Цифровой опцион и колл-спред}
\justifying
\only<1>{Колл-спред: купить колл-\leftstrikeA, продать колл-\rightstrikeA}
\only<2>{Колл-спред: купить 2 колла-\leftstrikeB, продать 2 колла-\rightstrikeB}
\only<3>{Колл-спред: купить 10 коллов-\leftstrikeC, продать 10 коллов-\rightstrikeC}

\centering
	\begin{tikzpicture}		
		\begin{axis}[
			domain=(\usdrubstrike-2):(\usdrubstrike+2),
			xmin=(\usdrubstrike-2), xmax=(\usdrubstrike+2),
			ymin=-1.5, ymax=1.5,
			xtick distance=1,
			ytick distance=0.5,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
			%scaled x ticks=false
		]

\only<1>{
	\addplot[Set1-A, very thick, dashed, samples=201] {(\x > \leftstrikeA)*(\x - \leftstrikeA) - 0.03};
  	\addplot[Set1-B, very thick, dashed, samples=201] {-(\x > \rightstrikeA)*(\x - \rightstrikeA) + 0.06};
  	\addplot[Set1-C, very thick, samples=201] {(\x > \leftstrikeA)*(\x -\leftstrikeA) - (\x > \rightstrikeA)*(\x - \rightstrikeA) + 0.03};
}
\only<2>{
	\addplot[Set1-A, very thick, dashed, samples=201] {2*(\x > \leftstrikeB)*(\x - \leftstrikeB) - 0.03};
  	\addplot[Set1-B, very thick, dashed, samples=201] {-2*(\x > \rightstrikeB)*(\x - \rightstrikeB) + 0.06};
  	\addplot[Set1-C, very thick, samples=201] {2*(\x > \leftstrikeB)*(\x -\leftstrikeB) - 2*(\x > \rightstrikeB)*(\x - \rightstrikeB) + 0.03};
}
\only<3>{
	\addplot[Set1-A, very thick, dashed, samples=201] {10*(\x > \leftstrikeC)*(\x -\leftstrikeC) - 0.03};
  	\addplot[Set1-B, very thick, dashed, samples=201] {-10*(\x > \rightstrikeC)*(\x - \rightstrikeC) + 0.06};
  	\addplot[Set1-C, very thick, samples=201] {10*(\x > \leftstrikeC)*(\x -\leftstrikeC) - 10*(\x > \rightstrikeC)*(\x - \rightstrikeC) + 0.03};
}
 
   \draw[thick, color=black] (axis cs: (\usdrubstrike-2, 0) -- (axis cs: (\usdrubstrike+2, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Репликация цифрового опциона}
\justify
Цифровой колл-опцион со страйком $K$ можно приблизить колл-спредом из ванильных
колл-опционов со страйками $K-\varepsilon$ и $K+\varepsilon$:
\begin{align*}
D(K) \approx nC\left(K - \dfrac{1}{2n}\right) - nC\left(K + \dfrac{1}{2n}\right)
\end{align*}
Здесь $C(K)$ --- цена ванильного колл-опциона со страйком $K$, $D(K)$ --- цена 
цифрового колла, $n$ --- число ванильных опционов в колл-спреде, $\varepsilon=1/2n$

\justify
Хозяйке на заметку: цена цифрового опциона --- производная цены ванильного опциона по 
страйку.
\begin{align*}
D(K) = \lim\limits_{\varepsilon\to 0}\dfrac{C(K-\varepsilon) - C(K+\varepsilon)}{2\varepsilon} = -\dfrac{\partial C}{\partial K}
\end{align*}
\end{frame}



\begin{frame}{Паритет колл-пут для цифровых опционов}
\justify
Рассмотрим портфель из цифрового колла и цифрового пута с одинаковым страйком:

\justify
1. Колл выплачивает 1 единицу валюты, если цена базового актива $\ge K$ (*).

\justify
2. Пут выплачивает 1 единицу валюты, если цена базового актива $< K$.

\justify
Портфель из цифрового колла и пута выплачивает 1 единицу валюты всегда, что бы ни 
случилось, то есть это --- безрисковый депозит.
\begin{align*}
C_{digital}(K) + P_{digital}(K) = e^{-rT}
\end{align*}

\justify
(*) Предположим, что колл выплачивает 1 единицу и при точном попадании в страйк.
\end{frame}



\begin{frame}{Барьерные опционы}
\justify
Выплата по \alert{опциону с барьером} (\en{barrier option}) зависит от того, примет ли цена базового 
актива определённое значение.

\justify
1. \alert{\en{Knock-in (KI)}}\ барьер: опцион возникает, только если цена достигает данного уровня.

2. \alert{\en{Kock-out (KO)}}\ барьер: опцион пропадает, если цена достигает данного уровня.

\justify
1. Европейский барьер: наблюдается только в момент экспирации.

2. Американский барьер: наблюдается всё время жизни опциона.

3. Оконный барьер: наблюдается в определённый промежуток времени.

\justify
Обычно инвесторы добавляют барьеры в опционы, чтобы сделать их дешевле.
\end{frame}


\begin{frame}{Пример: европейский барьер}
\justify
Колл со страйком \usdrubstrike\ и европейским knock-out барьером \usdrubbarrier.

\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike-6):(\usdrubstrike+10),
			xmin=(\usdrubstrike-6), xmax=(\usdrubstrike+10),
			ymin=-3, ymax=8,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
			%scaled x ticks=false
		]
  \addplot[Set1-A, very thick, samples=201, domain=(\usdrubstrike-6):(\usdrubbarrier-0.01)] {(\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.03};
  \addplot[Set1-A, very thick,domain=\usdrubbarrier:(\usdrubstrike+10)] {0.03};
  
   \draw[thick, color=black] (axis cs: (\usdrubstrike-6, 0) -- (axis cs: (\usdrubstrike+10, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Репликация европейских опционов}
\justify
Любой дериватив <<европейского>> типа (тот, в котором выплата определяется ценой 
базового актива на момент экспирации) можно реплицировать комбинацией ванильных и/или
цифровых европейских опционов.

\justify
1. В точках, где график выплаты <<ломается>> добавляем ванильный опцион.

\justify
2. В точках, где график выплаты разрывный, добавляем цифровой опцион.

\justify
Как реплицировать европейский колл со страйком \usdrubstrike\ и европейским \en{knock-out}\
барьером \usdrubbarrier?
\end{frame}



\begin{frame}{Репликация европейского барьера}
\justify
Купить ванильный колл-\usdrubstrike
\only<2->{, продать ванильный колл-\usdrubbarrier}
\only<3->{, продать 4 цифровых колла-\usdrubbarrier}
\justify
\centering
	\begin{tikzpicture}
		\begin{axis}[
			domain=(\usdrubstrike-6):(\usdrubstrike+10),
			xmin=(\usdrubstrike-6), xmax=(\usdrubstrike+10),
			ymin=-5, ymax=6,
			xtick distance=2,
			ytick distance=1,
			grid = major,
			xlabel={Курс в дату экспирации},
			ylabel={Выплата (payoff)},
			%scaled x ticks=false
		]
  \addplot[Set1-A, very thick, dashed] {(\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.06};
\only<2->{
  \addplot[Set1-B, very thick, dashed] {-(\x > \usdrubbarrier)*(\x - \usdrubbarrier) - 0.03};
}
\only<2>{
  \addplot[Set1-C, very thick] {-(\x > \usdrubbarrier)*(\x - \usdrubbarrier) - 0.03 + (\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.06};
}
\only<3->{
	\addplot[Set1-E, very thick, dashed, domain=(\usdrubstrike-6):\usdrubbarrier] {-0.06};
	\addplot[Set1-E, very thick, dashed, domain=\usdrubbarrier:(\usdrubstrike+10)] {-4};
}
\only<3>{
	\addplot[Set1-C, very thick, domain=(\usdrubstrike-6):\usdrubbarrier] {-(\x > \usdrubbarrier)*(\x - \usdrubbarrier) - 0.03 + (\x > \usdrubstrike)*(\x - \usdrubstrike) + 0.06};
	\addplot[Set1-C, very thick, domain=\usdrubbarrier:\usdrubstrike+10] {0.03};
}

   \draw[thick, color=black] (axis cs: (\usdrubstrike-6, 0) -- (axis cs: (\usdrubstrike+10, 0);
\end{axis}
\end{tikzpicture}
\end{frame}



\begin{frame}{Барьерные опционы: пример}
\justify
<<В декабре 2013 года «Транснефть» купила барьерные опционы у Сбербанка с целью снизить стоимость обслуживания облигаций.>>

\justify
<<Компания «Транснефть» подала иск к Сбербанку, в котором требует признать недействительной сделку с производными инструментами, которая была заключена перед валютным кризисом 2014 года и принесла компании миллиардные убытки.>>

\justify
\small
\url{www.rbc.ru/business/27/01/2017/588b62d79a7947730d59c4fe}
\end{frame}


\begin{frame}{Кто продаёт опционы?}
\justify
Опционы --- удобный инструмент и для хеджирования, и для спекуляции. Возможные потери 
ограниченны снизу, потому что покупатель не может потерять больше, чем премию. Потенциальная прибыль не ограниченна сверху (для колл-опциона).

\justify
Кто же тогда продаёт опционы, то есть соглашается на ограниченную прибыль в обмен на 
неограниченные убытки?
\end{frame}



\begin{frame}{Кто продаёт опционы?}
\justify
Несколько стратегий в среднем на дистанции давали в прошлом положительную доходность.

\justify
\begin{itemize}
\justifying
\item Covered call: длинная позиция в индексе акций и проданный колл-опцион с высоким страйком.
\item Short straddle: проданный стрэддл с динамическим дельта-хеджированием (об этом позже).
\item Short OTM put: продажа опционов пут на индекс акций с низким страйком --- страховок от падения рынка.
\end{itemize}

\justify
Все три стратегии <<продают волатильность>> --- делают ставку на то, что в будущем рынок будет колебаться не так сильно, как ожидают покупатели опционов. Опционы похожи на страховку. Они стоят достаточно дорого, чтобы на дистанции продавцы страховок в среднем зарабатывали деньги.
\end{frame}



\begin{frame}{Продажа out-of-the-money пута}
\justify
Индекс S\&P\,500 сейчас находится на уровне \$5\,120 (15 марта 2024 г.). Пут-опцион со страйком \$3\,300, который истекает 3 мая, стоит \$1 на \en{Chicago Mercantile Exchange (CME)}.

\justify
Если вы продадите 1\,000 таких опционов, то вы заработаете премию \$1\,000 практически без риска. В последний раз индекс S\&P\,500 падал на 35\% за 7 недель в 1929 году в разгар Великой депрессии.

\justify
Внимание: если Великая депрессия всё-таки повторится, и индекс упадёт до \$3\,200, то вы потеряете \$99\,000.

\justify
Хватит ли у вас храбрости продать кому-то такую страховку от кризиса?

\justify
Можно ли придумать что-то менее пугающее?
\end{frame}



\begin{frame}{Индекс PUT}
\justify
Чикагская опционная биржа (\en{Chicago Board of Option Exchange, CBOE}) публикует индекс \en{S\&P\,500 PutWrite Index ("PUT")}, который отражает результаты следующей стратегии.

\justify
1. Продать одномесячный \en{at-the-money}\ пут-опцион на индекс \en{S\&P\,500}. Например, продать опцион со страйком $K=\$5\,120$, если текущий уровень индекса \$5\,120.

\justify
2. Вложить $K$ долларов в безрисковые одномесячные облигации США. Так деньги будут всегда под рукой на случай, если рынок всё-таки упадёт и покупатель исполнит опцион.

\justify
3. В хорошем случае вы просто заработаете премию. В плохом случае вы потеряете какие-то деньги ($K-S$, где $S$ --- уровень индекса), но вы не когда уйдёте ниже нуля.

\justify
4. Повторить через месяц.
\end{frame}



\begin{frame}{Индекс PUT - 2}
\centering
\begin{tikzpicture}
\begin{axis}[
 	width=\textwidth,
	height=\textheight - 1cm,
	date coordinates in=x,
	date ZERO=1987-01-01,
  	xtick={1990-01-01, 2000-01-01, 2010-01-01, 2020-01-01},
  	minor xtick={1995-01-01, 2005-01-01, 2015-01-01, 2025-01-01},
  	xticklabel={\year},
  	xmin=1987-01-01,
  	xmax=2025-01-01,
	 ymode = log,
 	grid=both,
   	log ticks with fixed point,
  	ylabel={\small{Рост \$1 инвестиций}},
  	xlabel near ticks,
  	ylabel near ticks,
	legend entries = {
		Индекс S\&P\,500 Total Return,
		Индекс CBOE PUT,
		Безрисковые T-bills
	},
	legend pos=north west,
	legend style={font=\scriptsize},
	legend cell align={left}
]

\addplot[color = Set1-A, mark = none, very thick]
	table[
		x=month,
		y=sp500_growth,
		col sep=comma
	]
	{cboe_puty.csv};

\addplot[color = Set1-B, mark = none, very thick]
	table[
		x=month,
		y=put_growth,
		col sep=comma
	]
	{cboe_puty.csv};

\addplot[color = Set1-C, mark = none, very thick, dashed]
	table[
		x=month,
		y=rf_growth,
		col sep=comma
	]
	{cboe_puty.csv};

   \draw[thick, color=black] (axis cs: 1985-01-01, 1) -- (axis cs: 2025-01-01, 1);
\end{axis}
\end{tikzpicture}
\small Данные: CBOE, Robert Shiller, Kenneth French.
\end{frame}



\begin{frame}{Индекс PUT - 3}
\centering
\begin{tabular}{l|r|r|r}
& PUT & S\&P\,500 & T-bill \\ \hline
Геом. среднее & 9.4\% & 10.6\% & 2.9\% \\
Избыт. дох-ть & 6.3\% & 7.4\% & 0.0\% \\
Ст. откл. & 11.0\% & 16.0\% & 0.0\% \\
Отн. Шарпа & 0.58 & 0.46 & 0.0 \\
Мес. бета & 0.47 & 1.00 & 0.00
\end{tabular}

\small Период: 1987--2023. Все метрики, кроме беты, в годовом выражении.

\justify
Индекс PUT показал лучшее соотношение риска и доходности (отношение Шарпа). Продавать другим страховки от падения рынка выглядит более интересной стратегией, чем инвестиции в сам рынок.

\justify
Святой Грааль финансов найден? В чём подвох?
\end{frame}



\begin{frame}{Индекс PUT - 4}

\justify
<<Чёрный понедельник>> 19 октября 1987 г. был худшим днём в истории и индекса \en{PUT}, и индекса S\&P\,500.

\centering
\begin{tabular}{l|r|r}
& PUT & S\&P\,500 \\ \hline
19 октября 1987 & $-24.4\%$ & $-20.5\%$ \\
Октябрь 1987 & $-15.8\%$ & $-11.9\%$ \\
1987 & $-2.6\%$ & $-0.1\%$ 
\end{tabular}

\justify
Это тот самый риск толстых хвостов (\en{tail risk}). В среднем, продажа страховок --- прибыльный бизнес, потому что люди не любят риск и готовы заплатить за страховку. Вы можете попытаться собирать эту премию за риск, если вы готовы нести такой риск.

\justify
Отношение Шарпа измеряет риск как стандартное отклонение. Это плохая метрика для опционных стратегий, потому что у них часто толстый левый хвост (маловероятные огромные убытки).
\end{frame}



\newcommand{\drawStockNode}[5]{

	\node (#5)
	[
		draw,
		rectangle,
		rounded corners,
		inner sep = 0pt,
		outer sep = 0pt,
		minimum width = 2.4cm,
		minimum height = 0.55cm,
		align = center
	]
	at (#3, #4)
	{
		\begin{tabular}{c|c}
		#1 & #2
		\end{tabular}
	};
}

\newcommand{\drawStockLink}[4]{

	\draw[
		->,
		>=triangle 90
	]
	(#1.east) -- (#2.west)
	node[
		pos = 0.5,
		anchor = #4
	]
	{#3};
}

\newcommand{\drawOneStepBinomialTree}{
	\drawStockNode{\$100}{?}{0}{0}{S0_node}
	\drawStockNode{\$120}{\$20}{4}{ 1}{Su_node}
	\drawStockNode{\$80}{\$0}{4}{-1}{Sd_node}
	
	\drawStockLink{S0_node}{Su_node}{$90\%$}{south east}	
	\drawStockLink{S0_node}{Sd_node}{$10\%$}{north east}
}

\begin{frame}{Биномиальная модель}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
	\draw (S0_node.east) [dashed] -- (3, 0) node[anchor=west] {K=\$100};
\end{tikzpicture}

\justify
Текущая цена акции $\$100$. Завтра она может стоить либо $\$120$ с вероятностью $90\%$, либо $\$80$ с вероятностью $10\%$. Безрисковая процентная ставка $r=0\%$.

\justify
Сколько стоит европейский колл-опцион со страйком $K=\$100$, истекающий завтра?

\justify
Математическое ожидание:
$$\mathbb{E}(Payoff) = 0.9\cdot \$20 + 0.1\cdot \$0 = \$18 $$
\end{frame}



\begin{frame}{Репликация в биномиальной модели}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
	\draw (S0_node.east) [dashed] -- (3, 0) node[anchor=west] {K=\$100};
\end{tikzpicture}

\justify
Рассмотрим портфель $\Pi$, который состоит из $0.5$ акции и долга в $\$40$, который нужно отдать завтра.

\justify
Если акция будет стоить \$120, то портфель будет стоить
\begin{align*}\Pi = 0.5\cdot\$120 - \$40 = \$20\end{align*}

\justify
Если акция будет стоить \$80, то портфель будет стоить
$$\Pi = 0.5 \cdot \$80 - \$40 = \$0$$

\justify
Портфель $\Pi$ \alert{реплицирует} опцион!
\end{frame}



\begin{frame}{Репликация в биномиальной модели - 2}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
	\draw (S0_node.east) [dashed] -- (3, 0) node[anchor=west] {K=\$100};
\end{tikzpicture}


\justify
Если портфель из долга и $0.5$ акции \alert{завтра} принесёт столько же денег, сколько и колл-опцион, то \alert{сегодня} они должны стоить одинаково.
\begin{align*}
C_{K=100} = \Pi_0 = 0.5 \cdot \$100 - \$40 = \$10
\end{align*}

Ответ не зависит от вероятностей 90\% и 10\%! Мы устранили всю неопределённость, связанную с будущей ценой акции.
\end{frame}



\begin{frame}{Арбитраж в биномиальной модели}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
	\draw (S0_node.east) [dashed] -- (3, 0) node[anchor=west] {K=\$100};
\end{tikzpicture}

\justify
Если опцион стоит \$18, то возможен арбитраж:
\begin{itemize}
\item Продать (выписать) опцион за \$18.
\item Взять в долг \$32.
\item Купить 0.5 акции за \$50.
\item Подождать до завтра.
\item Если акция стоит \$80, то продать 0.5 акции за \$40, выплатить долг \$32. Прибыль \$8.
\item Если акция стоит \$120, то купить еще 0.5 акции за \$60, продать держателю опциона за \$100, выплатить долг \$32. Прибыль \$8.
\end{itemize}
\end{frame}



\renewcommand{\drawOneStepBinomialTree}{
	\drawStockNode{$S_0$}{?}{0}{0}{S0_node}
	\drawStockNode{$S_0u$}{$V_u$}{4}{ 1}{Su_node}
	\drawStockNode{$S_0d$}{$V_d$}{4}{-1}{Sd_node}
	
	\drawStockLink{S0_node}{Su_node}{$p$}{south east}	
	\drawStockLink{S0_node}{Sd_node}{$1 - p$}{north east}
}

\begin{frame}{Обобщённая биномиальная модель}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
\end{tikzpicture}

\justify
Текущая цена акции $S_0$.

\justify
Цена акции может либо вырасти до $S_0\cdot u$ (u>1) либо снизиться до $S_0 \cdot d$ (d<1).

\justify
Длина одного периода $\tau$ лет, безрисковая  процентная ставка $r$, причём $d < 1+r\tau < u$.

\justify
В случае роста или падения акции опцион принесет (будет иметь value) либо $V_u$, либо $V_d$.
\end{frame}



\begin{frame}{Обобщённая биномиальная модель - 2}
\centering
\begin{tikzpicture}
	\drawOneStepBinomialTree
\end{tikzpicture}

\justify
Рассмотрим портфель, состоящий из $\Delta$ акций и долга $L$. 
\begin{equation*}
\begin{cases}
L(1+r\tau) + \Delta S_0 u = V_u \\
L(1+r\tau) + \Delta S_0 d = V_d
\end{cases}
\end{equation*}

\begin{equation*}
\begin{cases}
\Delta = \dfrac{V_u - V_d}{S_0(u-d)} \\
L = \dfrac{V_du - V_ud}{(1+r\tau)(u-d)}
\end{cases}
\end{equation*}
\end{frame}



\begin{frame}{Обобщённая биномиальная модель - 3}
\centering
\begin{tikzpicture}
\drawOneStepBinomialTree
\end{tikzpicture}

\justify
Цена опциона равна цене реплицирующего портфеля:
\begin{align*}
C &= \Delta S_0 +L 
= \dfrac{V_u-V_d}{(u-d)\cancel{S_0}}\cancel{S_0} + \dfrac{V_du -V_ud}{(1+r\tau)(u-d)} = \\
 &= \dfrac{qV_u +(1-q)V_d}{1+r\tau},
\end{align*}
где
\begin{equation*}
q = \dfrac{1+r\tau - d}{u-d} \text{ --- <<риск-нейтральная вероятность>>}
\end{equation*}
\end{frame}



\renewcommand{\drawStockLink}[2]{

	\draw[
		->,
		>=triangle 45
	]
	(#1.east) -- (#2.west)
	{};
}

\renewcommand{\drawStockNode}[5]{

	\node (#5)
	[
		draw,
		rectangle,
		rounded corners,
		inner sep = 1pt,
		outer sep = 0pt,
		minimum width = 1.5cm
	]
	at (#3, #4)
	{
		\centering
		\begin{tabular}{c}
		#1 \\ \hline #2
		\end{tabular}
	};
}

\newcommand{\nodeVerticalStep}{0.7}
\newcommand{\nodeHorizontalStep}{2.75}

\begin{frame}{Многошаговая биномиальная модель}
\centering
\begin{tikzpicture}
\drawStockNode{$\$100$}{\only<1-7>{?}\only<8->{\$14.8}}{0}{0}{S0_node}

\drawStockNode{$\$120$}{\only<1-5>{?}\only<6->{\$25.8}}{\nodeHorizontalStep}{\nodeVerticalStep}{Su_node}
\drawStockNode{$\$80$}{\only<1-6>{?}\only<7->{\$3.8}}{\nodeHorizontalStep}{-\nodeVerticalStep}{Sd_node}

\drawStockNode{$\$144$}{\only<1-2>{?}\only<3->{\$44}}{2*\nodeHorizontalStep}{2*\nodeVerticalStep}{Suu_node}
\drawStockNode{$\$96$}{\only<1-3>{?}\only<4->{\$7.6}}{2*\nodeHorizontalStep}{0}{Sud_node}
\drawStockNode{$\$64$}{\only<1-4>{?}\only<5->{\$0}}{2*\nodeHorizontalStep}{-2*\nodeVerticalStep}{Sdd_node}

\drawStockNode{$\$172.8$}{\only<1>{?}\only<2->{\$72.8}}{3*\nodeHorizontalStep}{3*\nodeVerticalStep}{Suuu_node}
\drawStockNode{$\$115.2$}{\only<1>{?}\only<2->{\$15.2}}{3*\nodeHorizontalStep}{\nodeVerticalStep}{Suud_node}
\drawStockNode{$\$76.8$}{\only<1>{?}\only<2->{\$0}}{3*\nodeHorizontalStep}{-\nodeVerticalStep}{Sudd_node}
\drawStockNode{$\$51.2$}{\only<1>{?}\only<2->{\$0}}{3*\nodeHorizontalStep}{-3*\nodeVerticalStep}{Sddd_node}

\drawStockLink{S0_node}{Su_node}
\drawStockLink{S0_node}{Sd_node}

\drawStockLink{Su_node}{Suu_node}
\drawStockLink{Su_node}{Sud_node}

\drawStockLink{Sd_node}{Sud_node}
\drawStockLink{Sd_node}{Sdd_node}

\drawStockLink{Suu_node}{Suuu_node}
\drawStockLink{Suu_node}{Suud_node}

\drawStockLink{Sud_node}{Suud_node}
\drawStockLink{Sud_node}{Sudd_node}

\drawStockLink{Sdd_node}{Sudd_node}
\drawStockLink{Sdd_node}{Sddd_node}
\end{tikzpicture}

\justify
Предположим, что $u=1.2$, $d=0.8$, $S_0=\$100$, $r=0\%$. Сколько стоит колл со страйком $K=100$?

\justify
<<Риск-нейтральная вероятность>>:
\begin{align*}
q = \dfrac{1+r\tau - d}{u - d} = \dfrac{1 - 0.8}{1.2 - 0.8} = 0.5
\end{align*}
\end{frame}



\begin{frame}{Многошаговая биномиальная модель - 2}
\centering
\begin{tikzpicture}
\drawStockNode{$\$100$}{$\Delta=0.58$}{0}{0}{S0_node}

\drawStockNode{$\$120$}{$\Delta=0.76$}{\nodeHorizontalStep}{\nodeVerticalStep}{Su_node}
\drawStockNode{$\$80$}{$\Delta=0.24$}{\nodeHorizontalStep}{-\nodeVerticalStep}{Sd_node}

\drawStockNode{$\$144$}{$\Delta=1.0$}{2*\nodeHorizontalStep}{2*\nodeVerticalStep}{Suu_node}
\drawStockNode{$\$96$}{$\Delta=0.4$}{2*\nodeHorizontalStep}{0}{Sud_node}
\drawStockNode{$\$64$}{$\Delta=0.0$}{2*\nodeHorizontalStep}{-2*\nodeVerticalStep}{Sdd_node}

\drawStockNode{$\$172.8$}{$\Delta=1$}{3*\nodeHorizontalStep}{3*\nodeVerticalStep}{Suuu_node}
\drawStockNode{$\$115.2$}{$\Delta=1$}{3*\nodeHorizontalStep}{\nodeVerticalStep}{Suud_node}
\drawStockNode{$\$76.8$}{$\Delta=0$}{3*\nodeHorizontalStep}{-\nodeVerticalStep}{Sudd_node}
\drawStockNode{$\$51.2$}{$\Delta=0$}{3*\nodeHorizontalStep}{-3*\nodeVerticalStep}{Sddd_node}

\drawStockLink{S0_node}{Su_node}
\drawStockLink{S0_node}{Sd_node}

\drawStockLink{Su_node}{Suu_node}
\drawStockLink{Su_node}{Sud_node}

\drawStockLink{Sd_node}{Sud_node}
\drawStockLink{Sd_node}{Sdd_node}

\drawStockLink{Suu_node}{Suuu_node}
\drawStockLink{Suu_node}{Suud_node}

\drawStockLink{Sud_node}{Suud_node}
\drawStockLink{Sud_node}{Sudd_node}

\drawStockLink{Sdd_node}{Sudd_node}
\drawStockLink{Sdd_node}{Sddd_node}
\end{tikzpicture}

\justify
Справедливая безарбитражная цена опциона не зависит от вероятностей изменения цены вверх и вниз. Если мы можем \alert{динамически} ребалансировать портфель, состоящий из акций и долга, то мы можем реплицировать любой опцион.

\justify
Эта стратегия называется \alert{дельта-хеджирование} (\en{delta hedging}).
\end{frame}



\newcommand{\highlightStockLink}[6]{
	\draw[
		color=#4,
		very thick,
		->,
		>=triangle 45
	]
	(#1.east) -- (#2.west)
	node[
		pos=#5,
		anchor=#6
	]
	{#3};
}

\newcommand{\highlightStockLinkUp}[3]{
	\highlightStockLink{#1}{#2}{$q$}{#3}{0.5}{south}
}

\newcommand{\highlightStockLinkDown}[3]{
	\highlightStockLink{#1}{#2}{$1-q$}{#3}{0.15}{west}
}

\begin{frame}{Многошаговая биномиальная модель - 3}
\centering
\begin{tikzpicture}
\drawStockNode{$S_0$}{?}{0}{0}{S0_node}

\drawStockNode{$S_0u$}{?}{\nodeHorizontalStep}{\nodeVerticalStep}{Su_node}
\drawStockNode{$S_0d$}{?}{\nodeHorizontalStep}{-\nodeVerticalStep}{Sd_node}

\drawStockNode{$S_0u^2$}{?}{2*\nodeHorizontalStep}{2*\nodeVerticalStep}{Suu_node}
\drawStockNode{$S_0ud$}{?}{2*\nodeHorizontalStep}{0}{Sud_node}
\drawStockNode{$S_0d^2$}{?}{2*\nodeHorizontalStep}{-2*\nodeVerticalStep}{Sdd_node}

\drawStockNode{$S_0u^3$}{$V_3$}{3*\nodeHorizontalStep}{3*\nodeVerticalStep}{Suuu_node}
\drawStockNode{$S_0u^2d$}{$V_2$}{3*\nodeHorizontalStep}{\nodeVerticalStep}{Suud_node}
\drawStockNode{$S_0ud^2$}{$V_1$}{3*\nodeHorizontalStep}{-\nodeVerticalStep}{Sudd_node}
\drawStockNode{$S_0d^3$}{$V_0$}{3*\nodeHorizontalStep}{-3*\nodeVerticalStep}{Sddd_node}

\only<1-2>{
	\drawStockLink{S0_node}{Su_node}
	\drawStockLink{S0_node}{Sd_node}

	\drawStockLink{Su_node}{Suu_node}
	\drawStockLink{Su_node}{Sud_node}

	\drawStockLink{Sd_node}{Sud_node}
	\drawStockLink{Sd_node}{Sdd_node}

	\drawStockLink{Suu_node}{Suuu_node}
	\drawStockLink{Suu_node}{Suud_node}

	\drawStockLink{Sud_node}{Suud_node}
	\drawStockLink{Sud_node}{Sudd_node}

	\drawStockLink{Sdd_node}{Sudd_node}
	\drawStockLink{Sdd_node}{Sddd_node}
}

\only<3>{
	\highlightStockLinkUp{S0_node}{Su_node}{Set1-A}
	\highlightStockLinkUp{Su_node}{Suu_node}{Set1-A}
	\highlightStockLinkDown{Suu_node}{Suud_node}{Set1-A}
}

\only<4>{
	\highlightStockLinkUp{S0_node}{Su_node}{Set1-A}
	\highlightStockLinkDown{Su_node}{Sud_node}{Set1-A}
	\highlightStockLinkUp{Sud_node}{Suud_node}{Set1-A}
}

\only<5>{
	\highlightStockLinkDown{S0_node}{Sd_node}{Set1-A}
	\highlightStockLinkUp{Sd_node}{Sud_node}{Set1-A}
	\highlightStockLinkUp{Sud_node}{Suud_node}{Set1-A}
}

\end{tikzpicture}

\justify
Риск-нейтральная вероятность: $q = \dfrac{1 + rT - d}{u - d}$.

\justify
Цена дериватива сегодня:
\begin{align*}
V = \frac{q^3V_3 + \only<1>{3q^2(1-q)}\only<2->{\alert{3q^2(1-q)}}V_2 + 3q(1-q)^2V_1 + (1-q)^3V_0}{(1+rT)^3}
\end{align*}
\end{frame}



\begin{frame}{Риск-нейтральная вероятность}
\justify
Если представить, что $q$ --- вероятность движения акции вверх, то $3q^2(1-q)$ --- вероятность того, что акция дважды вырастет и один раз упадёт (не важно, в каком порядке). Тогда акция будет стоить $S_0u^2d$, а дериватив принесёт прибыль $V_2$.

\justify
\centering
\begin{tabular}{l|l|l}
Цена акции & Прибыль & <<Вероятность>> \\ \hline
$S_0u^3$   & $V_3$   & $q^3$ \\
$S_0u^2d$  & $V_2$   & $3q^2(1-q)$ \\
$S_0ud^2$  & $V_1$   & $3q(1-q)^2$ \\ 
$S_0d^3$   & $V_0$   & $(1-q)^3$ 
\end{tabular}

\justify
Цена дериватива похожа на дисконтированное <<математическое ожидание>> выплаты.
\begin{align*}
V = \frac{q^3V_3 + 3q^2(1-q)V_2 + 3q(1-q)^2V_1 + (1-q)^3V_0}{(1+rT)^3}
\end{align*}
\end{frame}



\begin{frame}{Биномиальная модель и модель Блэка-Шоулза}
Для дерева, состоящего из $n$ шагов:
\begin{align*}
C &= \dfrac{\sum\limits_{k=0}^{n} C^k_nq^k(1-q)^{n-k}V(S_0u^kd^{n-k})}{(1+r\tau)^n} \\
C^k_n &= \dfrac{n!}{k!(n-k)!}
\end{align*}

\justify
Что будет, если вместо произвольной функции $V(S)$ взять функцию $max(S-K,0)$, как в колл-опционе, и устремить $n$ к бесконечности? Получится формула Блэка-Шоулза.

\vspace{\baselineskip}
Строгое доказательство с помощью закона больших чисел и центральной
предельной теоремы здесь (28 страниц):

\url{http://www.math.cmu.edu/~handron/21_370/BS.pdf}
\end{frame}

\end{document}